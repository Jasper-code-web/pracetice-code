# ref

类型限制

```javascript
//第一种方式
const Man = ref<string>('小满')

//第二种方式
import type { Ref } from 'vue';
const Man: Ref<string> = ref('小满')
```

# isRef

判断是否是ref类型

# triggerRef

```typescript
//类型
function triggerRef(ref: ShallowRef): void
```

强制触发依赖于一个浅层ref的副作用，通常在对浅引用的内部值进行深度变更后使用

# shallowRef

是浅层ref，和ref区别在于它不会深层递归响应式。只有对`` .value``的访问是响应式的

> 注意：shallowRef和ref不能同时使用。因为ref会默认触发triggerRef()
>
> ```javascript
> const change = () => {
>   Man.value= '我是ref'
>   state.value.count.name = '我是shallowRef'
> }
> ```



作用： 1. 减少大型不可变数据的响应性开销

​			2.避免不必要的组件抽象

# customRef

创建一个自定义的ref,显示声明对其依赖追踪和更新触发的控制方式

```typescript
//customRef类型
function customRef<T>(factory: CustomRefFactory<T>): Ref<T>

type CustomRefFactory<T> = (
	track: () => void,
	trigger: () => void
) => {
    get: () => T
    set: (value: T) => void
}
```


例子
```typescript
function myRef<T>(value: T) {
  return customRef((track, trigger) => {
    return {
      get() {
        track()
        return value
      },
      set(newValue) {
        value = newValue
        trigger()
      }
    }
  })
}

//debounce防抖延迟更新数据
const adata = useDebouncedRef('hello')
const change = () => {
  adata.value = 'b'
  console.log('aa')
}
function useDebouncedRef(value: any, delay = 200) {
  let timeout:number = 0
  return customRef((track, trigger) => {
    return {
      get() {
        track()
        return value
      },
      set(newValue) {
        clearTimeout(timeout)
        timeout = setTimeout(() => {
          console.log('修改le')
          value = newValue
          console.log('value',value)
          trigger()
        }, delay)
      }
    }
  })
}
```

# 工具使用技巧

1.ref或者reactive嵌套太深，控制台debug查看数据不方便

* 安装devtools
* 浏览器偏好设置(preference)
* 控制台Console
* 点选自定义格式化(Enable custom formatters) 

2.ref可以通过绑定ref直接获取dom元素

```html
<div ref="dRef">
  <div><a href=""></a></div>
</div>
<script>
    import { ref } from 'vue';
    const dRef = ref()
    const change = () => {
      console.log(dRef.value?.innerHTML)
      //<div><a href=""></a></div>
    }
</script>
```





